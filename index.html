<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eem Anii - Maccabi TLV Pro 2026</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital,wght@0,400;0,600;0,700;0,800;0,900;1,400&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Barlow Condensed"', 'sans-serif'],
                    },
                    colors: {
                        'maccabi-blue': '#1e3a8a',
                        'maccabi-yellow': '#facc15',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Barlow Condensed', sans-serif;
        }

        /* Realistic Pitch Pattern */
        .pitch-pattern {
            background-color: #1a6d2f;
            background-image:
                linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
            background-size: 50px 50px;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.5);
        }


        .field-line {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.4);
        }

        .center-line {
            top: 50%;
            left: 0;
            width: 100%;
            height: 1.5px;
            transform: translateY(-50%);
        }

        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 15%;
            aspect-ratio: 1;
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            background: transparent;
        }

        .center-spot {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: white;
            transform: translate(-50%, -50%);
        }

        .penalty-box {
            position: absolute;
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            background: transparent;
        }

        .penalty-box-top {
            top: 0;
            left: 18%;
            width: 64%;
            height: 18%;
            border-top: none;
        }

        .penalty-box-bottom {
            bottom: 0;
            left: 18%;
            width: 64%;
            height: 18%;
            border-bottom: none;
        }

        .goal-box {
            position: absolute;
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            background: transparent;
        }

        .goal-box-top {
            top: 0;
            left: 35%;
            width: 30%;
            height: 7%;
            border-top: none;
        }

        .goal-box-bottom {
            bottom: 0;
            left: 35%;
            width: 30%;
            height: 7%;
            border-bottom: none;
        }

        .goalkeeper-arc {
            position: absolute;
            width: 12%;
            aspect-ratio: 1;
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            background: transparent;
            left: 50%;
            transform: translateX(-50%);
        }

        .goalkeeper-arc-top {
            top: 18%;
            transform: translate(-50%, -50%);
            clip-path: polygon(0 50%, 0 100%, 100% 100%, 100% 50%);
        }

        .goalkeeper-arc-bottom {
            bottom: 18%;
            transform: translate(-50%, 50%);
            clip-path: polygon(0 0, 0 50%, 100% 50%, 100% 0);
        }

        .penalty-spot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
        }

        .penalty-spot-top {
            top: 13%;
        }

        .penalty-spot-bottom {
            bottom: 13%;
        }

        .corner-arc {
            position: absolute;
            width: 2%;
            aspect-ratio: 1;
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            background: transparent;
        }

        .corner-top-left {
            top: -2%;
            left: -2%;
            clip-path: polygon(50% 50%, 100% 50%, 100% 100%, 50% 100%);
        }

        .corner-top-right {
            top: -2%;
            right: -2%;
            clip-path: polygon(0 50%, 50% 50%, 50% 100%, 0 100%);
        }

        .corner-bottom-left {
            bottom: -2%;
            left: -2%;
            clip-path: polygon(50% 0, 100% 0, 100% 50%, 50% 50%);
        }

        .corner-bottom-right {
            bottom: -2%;
            right: -2%;
            clip-path: polygon(0 0, 50% 0, 50% 50%, 0 50%);
        }

        .goal {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 12%;
            height: 2.5%;
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            background: transparent;
        }

        .goal-top {
            top: 0;
            border-top: none;
        }

        .goal-bottom {
            bottom: 0;
            border-bottom: none;
        }

        .player-node {
            touch-action: none;
            z-index: 20;
            transition: transform 0.2s;
        }

        .dragging {
            opacity: 0.3;
            transform: scale(1.1);
        }

        * {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }

        .tooltip {
            position: fixed;
            z-index: 1000;
            pointer-events: none;
        }

        /* Custom Scrollbar for Bench */
        .bench-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .bench-scroll::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
        }

        .bench-scroll::-webkit-scrollbar-thumb {
            background: #eab308;
            border-radius: 10px;
        }

        .bench-scroll::-webkit-scrollbar-thumb:hover {
            background: #ca8a04;
        }

        .bench-scroll {
            transform: rotateX(180deg);
        }

        .bench-scroll>* {
            transform: rotateX(180deg);
        }

        @keyframes pulse-gold {
            0% {
                box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.7);
                border-color: #facc15;
            }

            70% {
                box-shadow: 0 0 0 10px rgba(234, 179, 8, 0);
                border-color: #facc15;
            }

            100% {
                box-shadow: 0 0 0 0 rgba(234, 179, 8, 0);
            }
        }

        .drop-target-active {
            animation: pulse-gold 1.5s infinite;
            z-index: 40 !important;
            transform: scale(1.05);
        }
    </style>
</head>

<body
    class="bg-slate-950 text-white font-sans overflow-hidden bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        // FULL 2026 SQUAD DATA - Ligat Ha'Al 2025-26 season stats only
        const FULL_SQUAD = [
            // Starting 11 (vs Kiryat Shmona 02/02/2026) - Confirmed - Fixed Sides
            { id: 22, name: "Melika", number: 22, pos: "GK", native: "GK", mp: 11, cs: 6, strength: "Reflexes 82" },

            { id: 3, name: "Revivo", number: 3, pos: "DF", native: "LB", mp: 16, g: 0, a: 4, strength: "Crossing 85" },
            { id: 6, name: "Asante", number: 6, pos: "DF", native: "CB", mp: 17, g: 1, a: 1, strength: "Strength 84" },
            { id: 4, name: "Heitor", number: 4, pos: "DF", native: "CB", mp: 14, g: 1, a: 0, status: 'suspended-yellow', strength: "Aerial Duels 83" },
            { id: 21, name: "Ben Harush", number: 21, pos: "DF", native: "RB", mp: 12, g: 1, a: 0, strength: "Defensive Positioning 80" },

            { id: 42, name: "Dor Peretz", number: 42, pos: "MF", native: "CM", mp: 17, g: 10, a: 1, strength: "Late Runs Into Box 88" },
            { id: 30, name: "Itamar Noy", number: 30, pos: "MF", native: "CAM", mp: 18, g: 2, a: 2, strength: "Vision 82" },
            { id: 10, name: "Andrade", number: 10, pos: "MF", native: "CAM", mp: 17, g: 2, a: 1, strength: "Dribbling 84" },

            { id: 29, name: "Varela", number: 29, pos: "FW", native: "LW", mp: 17, g: 0, a: 3, strength: "Acceleration 86" },
            { id: 34, name: "Abu Farchi", number: 34, pos: "FW", native: "ST", mp: 17, g: 3, a: 1, strength: "Finishing 81" },
            { id: 77, name: "Davida", number: 77, pos: "FW", native: "RW", mp: 18, g: 2, a: 2, strength: "Pace 89" },

            // Bench / Full Squad
            { id: 90, name: "Mishpati", number: 90, pos: "GK", native: "GK", mp: 8, cs: 3, strength: "Handling 79" },
            { id: 28, name: "Sissokho", number: 28, pos: "MF", native: "CDM", mp: 13, g: 0, a: 1, status: 'yellow-risk', strength: "Interceptions 84" },
            { id: 36, name: "Ido Shahar", number: 36, pos: "MF", native: "CM", mp: 16, g: 9, a: 2, strength: "Long Shots 87" },
            { id: 11, name: "Jehezkel", number: 11, pos: "FW", native: "RW", mp: 19, g: 3, a: 4, status: 'yellow-risk', strength: "Creativity 85" },
            { id: 19, name: "Madmon", number: 19, pos: "FW", native: "ST", mp: 16, g: 3, a: 1, strength: "Offâ€‘Ball Movement 82" },
            { id: 41, name: "Ben Hamo", number: 41, pos: "DF", native: "CB", mp: 6, g: 0, a: 0, strength: "Tackling 80" },
            { id: 5, name: "Camara", number: 5, pos: "DF", native: "CB", mp: 14, g: 1, a: 0, status: 'yellow-risk', strength: "Aggression 83" },
            { id: 13, name: "Shlomo", number: 13, pos: "DF", native: "CB", mp: 12, g: 0, a: 1, strength: "Marking 82" },
            { id: 14, name: "Gropper", number: 14, pos: "DF", native: "LB", mp: 2, g: 0, a: 0, status: 'injured', strength: "Stamina 81" },
            { id: 17, name: "Belic", number: 17, pos: "MF", native: "CDM", mp: 8, g: 0, a: 1, status: 'injured', strength: "Ball Winning 83" },
            { id: 23, name: "Lederman", number: 23, pos: "MF", native: "CDM", mp: 6, g: 0, a: 0, strength: "Short Passing 80" },
            { id: 98, name: "Nicolaescu", number: 98, pos: "FW", native: "ST", mp: 9, g: 2, a: 1, status: 'injured', strength: "Finishing 84" },
            { id: 15, name: "Malede", number: 15, pos: "FW", native: "ST", mp: 2, g: 0, a: 0, strength: "Pace 84" },
            { id: 60, name: "Ben Simon", number: 60, pos: "FW", native: "ST", mp: 3, g: 0, a: 0, strength: "Heading 78" },
            { id: 70, name: "Sahiti", number: 70, pos: "MF", native: "RM", mp: 1, g: 0, a: 0, strength: "Work Rate 82" },
            { id: 27, name: "Magor", number: 27, pos: "FW", native: "LW", mp: 0, g: 0, a: 0, strength: "Dribbling 80" }
        ];

        // ... (skipping FORMATIONS) ...

        const FORMATIONS = {
            "4-2-3-1": [{ t: 88, l: 50 }, { t: 72, l: 85 }, { t: 75, l: 63 }, { t: 75, l: 37 }, { t: 72, l: 15 }, { t: 55, l: 65 }, { t: 55, l: 35 }, { t: 30, l: 82 }, { t: 25, l: 50 }, { t: 30, l: 18 }, { t: 12, l: 50 }],
            "4-3-3": [{ t: 88, l: 50 }, { t: 72, l: 15 }, { t: 75, l: 38 }, { t: 75, l: 62 }, { t: 72, l: 85 }, { t: 55, l: 50 }, { t: 42, l: 30 }, { t: 42, l: 70 }, { t: 20, l: 18 }, { t: 15, l: 50 }, { t: 20, l: 82 }],
            "3-5-2": [{ t: 88, l: 50 }, { t: 75, l: 25 }, { t: 78, l: 50 }, { t: 75, l: 75 }, { t: 52, l: 10 }, { t: 55, l: 32 }, { t: 55, l: 50 }, { t: 55, l: 68 }, { t: 52, l: 90 }, { t: 18, l: 35 }, { t: 18, l: 65 }],
            "4-4-2": [{ t: 88, l: 50 }, { t: 72, l: 15 }, { t: 75, l: 38 }, { t: 75, l: 62 }, { t: 72, l: 85 }, { t: 50, l: 15 }, { t: 52, l: 40 }, { t: 52, l: 60 }, { t: 50, l: 85 }, { t: 18, l: 35 }, { t: 18, l: 65 }],
            "5-4-1": [{ t: 88, l: 50 }, { t: 75, l: 10 }, { t: 78, l: 30 }, { t: 80, l: 50 }, { t: 78, l: 70 }, { t: 75, l: 90 }, { t: 52, l: 20 }, { t: 55, l: 40 }, { t: 55, l: 60 }, { t: 52, l: 80 }, { t: 22, l: 50 }],
            "4-1-4-1": [{ t: 88, l: 50 }, { t: 72, l: 15 }, { t: 75, l: 38 }, { t: 75, l: 62 }, { t: 72, l: 85 }, { t: 60, l: 50 }, { t: 38, l: 15 }, { t: 40, l: 38 }, { t: 40, l: 62 }, { t: 38, l: 85 }, { t: 15, l: 50 }],
            "Custom": null
        };

        const FloatingIcon = ({ setShowSplash }) => {
            // Position state: default bottom-right
            const [position, setPosition] = useState({
                x: window.innerWidth - 80,
                y: window.innerHeight - 200
            });
            const isDragging = React.useRef(false);
            const dragStart = React.useRef({ x: 0, y: 0 });
            const startPos = React.useRef({ x: 0, y: 0 });

            const onStart = (clientX, clientY) => {
                isDragging.current = true;
                dragStart.current = { x: clientX, y: clientY };
                startPos.current = { ...position };
            };

            const onMove = (clientX, clientY) => {
                if (!isDragging.current) return;
                const dx = clientX - dragStart.current.x;
                const dy = clientY - dragStart.current.y;
                setPosition({
                    x: Math.max(0, Math.min(window.innerWidth - 70, startPos.current.x + dx)),
                    y: Math.max(0, Math.min(window.innerHeight - 70, startPos.current.y + dy))
                });
            };

            const onEnd = (clientX, clientY) => {
                // If moved less than 5px, treat as click
                const dist = Math.sqrt(Math.pow(clientX - dragStart.current.x, 2) + Math.pow(clientY - dragStart.current.y, 2));
                if (isDragging.current && dist < 5) {
                    setShowSplash(true);
                }
                isDragging.current = false;
            };

            return (
                <div
                    onMouseDown={(e) => onStart(e.clientX, e.clientY)}
                    onTouchStart={(e) => onStart(e.touches[0].clientX, e.touches[0].clientY)}

                    style={{ top: position.y, left: position.x, touchAction: 'none' }}
                    className="fixed z-[90] w-16 h-16 rounded-full border-2 border-yellow-500 shadow-xl overflow-hidden cursor-move bg-slate-800 active:scale-95 transition-transform"
                >
                    {/* Global event listeners for move/up attached to window would be better, but for simplicity here attaching to document or using overlay */}
                    {/* Using a self-contained listener effect or event bubbling for simplicity */}
                    <div className="w-full h-full pointer-events-none">
                        <img src="./eem-ani.jpg" alt="Eem Ani" className="w-full h-full object-cover opacity-80" />
                    </div>
                    {/* Overlay for capturing move events outside the div */}
                    {isDragging.current && (
                        <div className="fixed inset-0 z-[100]"
                            onMouseMove={(e) => onMove(e.clientX, e.clientY)}
                            onTouchMove={(e) => onMove(e.touches[0].clientX, e.touches[0].clientY)}
                            onMouseUp={(e) => onEnd(e.clientX, e.clientY)}
                            onTouchEnd={(e) => onEnd(e.changedTouches[0].clientX, e.changedTouches[0].clientY)}
                        ></div>
                    )}
                </div>
            );
        };

        function App() {
            const [formation, setFormation] = useState("4-3-3");
            const [players, setPlayers] = useState(FULL_SQUAD.slice(0, 11).map((p, i) => ({
                ...p, top: FORMATIONS["4-3-3"][i].t, left: FORMATIONS["4-3-3"][i].l
            })));
            const [bench, setBench] = useState(FULL_SQUAD.slice(11));
            const [captainId, setCaptainId] = useState(42);
            const [dragInfo, setDragInfo] = useState(null);
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [isDragging, setIsDragging] = useState(null); // {playerIndex, startPos}
            const [showSplash, setShowSplash] = useState(true);
            const [isCapturing, setIsCapturing] = useState(false);
            const fieldRef = React.useRef(null);


            // Unified Drag & Drop Handler (Mouse & Touch)
            const dragItemRef = React.useRef(null); // { index, source, element, startX, startY, initialLeft, initialTop }
            const touchDragItem = React.useRef(null); // Track touch drag state without re-renders

            const onDragStart = (e, index, source) => {
                setDragInfo({ index, source }); // Keep for React state logic
                e.dataTransfer.effectAllowed = 'move';
            };

            const onDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            };

            const onDrop = (e, targetIndex, targetSource) => {
                e.preventDefault();
                e.stopPropagation();
                handleDropLogic(targetIndex, targetSource);
            };

            const handleDropLogic = (targetIndex, targetSource) => {
                if (!dragInfo && !touchDragItem.current) return;

                // Get info from either mouse state or touch ref
                const sourceIndex = dragInfo ? dragInfo.index : touchDragItem.current.index;
                const sourceSource = dragInfo ? dragInfo.source : touchDragItem.current.source;

                if (sourceIndex === targetIndex && sourceSource === targetSource) return;

                let newPlayers = [...players];
                let newBench = [...bench];

                // 1. Field <-> Field
                if (sourceSource === 'field' && targetSource === 'field') {
                    const sourcePlayer = newPlayers[sourceIndex];
                    const targetPlayer = newPlayers[targetIndex];

                    newPlayers[sourceIndex] = { ...targetPlayer, top: sourcePlayer.top, left: sourcePlayer.left };
                    newPlayers[targetIndex] = { ...sourcePlayer, top: targetPlayer.top, left: targetPlayer.left };

                    setPlayers(newPlayers);
                }
                // 2. Bench <-> Bench
                else if (sourceSource === 'bench' && targetSource === 'bench') {
                    const temp = newBench[sourceIndex];
                    newBench[sourceIndex] = newBench[targetIndex];
                    newBench[targetIndex] = temp;
                    setBench(newBench);
                }
                // 3. Bench (Source) -> Field (Target)
                else if (sourceSource === 'bench' && targetSource === 'field') {
                    const benchPlayer = newBench[sourceIndex];
                    const fieldPlayer = newPlayers[targetIndex];

                    newBench[sourceIndex] = fieldPlayer;
                    newPlayers[targetIndex] = { ...benchPlayer, top: fieldPlayer.top, left: fieldPlayer.left };

                    setPlayers(newPlayers);
                    setBench(newBench);
                }
                // 4. Field (Source) -> Bench (Target)
                else if (sourceSource === 'field' && targetSource === 'bench') {
                    const fieldPlayer = newPlayers[sourceIndex];
                    const benchPlayer = newBench[targetIndex];

                    newPlayers[sourceIndex] = { ...benchPlayer, top: fieldPlayer.top, left: fieldPlayer.left };
                    newBench[targetIndex] = fieldPlayer;

                    setPlayers(newPlayers);
                    setBench(newBench);
                }

                setDragInfo(null);
                touchDragItem.current = null;
            };

            // Touch Handlers
            const onTouchStart = (e, index, source) => {
                // e.preventDefault(); // Don't prevent default immediately to allow click/scroll if needed, but handled by touch-action: none for drag items
                const touch = e.touches[0];
                const element = e.currentTarget;
                const rect = element.getBoundingClientRect();

                // Calculate offset from center of element to touch point
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                // Store initial state
                touchDragItem.current = {
                    index,
                    source,
                    element,
                    startX: touch.clientX,
                    startY: touch.clientY,
                    offsetX: touch.clientX - centerX,
                    offsetY: touch.clientY - centerY,
                    originalZIndex: element.style.zIndex,
                    originalTransition: element.style.transition
                };

                // Visual feedback
                element.style.zIndex = 1000;
                element.style.transition = 'none'; // Disable transition for direct 1:1 movement

                setIsDragging({ playerIndex: index, source }); // Update UI state
            };

            const onTouchMove = (e) => {
                if (!touchDragItem.current) return;
                e.preventDefault(); // Prevent scrolling while dragging

                const touch = e.touches[0];
                const { startX, startY, element } = touchDragItem.current;

                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;

                element.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(1.1)`;
            };

            const onTouchEnd = (e) => {
                if (!touchDragItem.current) return;

                const { element, originalZIndex, originalTransition, offsetX, offsetY } = touchDragItem.current;

                // Reset styles
                element.style.transform = '';
                element.style.zIndex = originalZIndex || '';
                element.style.transition = originalTransition || '';

                // Find drop target
                // We need to briefly hide the dragged element to see what's underneath
                element.style.visibility = 'hidden';
                const touch = e.changedTouches[0];
                const targetElement = document.elementFromPoint(touch.clientX, touch.clientY);
                element.style.visibility = 'visible';

                if (targetElement) {
                    // Find closest draggable container
                    const closestTarget = targetElement.closest('[data-droptarget="true"]');

                    if (closestTarget) {
                        const targetIndex = parseInt(closestTarget.getAttribute('data-index'));
                        const targetSource = closestTarget.getAttribute('data-source');

                        if (!isNaN(targetIndex) && targetSource) {
                            handleDropLogic(targetIndex, targetSource);
                        } else {
                            // Maybe dropped on empty field?
                            handleFieldTouchDrop(touch.clientX - offsetX, touch.clientY - offsetY);
                        }
                    } else if (targetElement.closest('.pitch-pattern')) {
                        // Dropped on empty field logic
                        handleFieldTouchDrop(touch.clientX - offsetX, touch.clientY - offsetY);
                    }
                }

                setIsDragging(null);
                touchDragItem.current = null;
            };


            // Handle dropping on empty field (Move player)
            const captureField = async () => {
                setIsCapturing(true);
                await new Promise(r => setTimeout(r, 100)); // Allow UI update

                try {
                    if (!fieldRef.current) return;

                    const canvas = await html2canvas(fieldRef.current, {
                        useCORS: true,
                        backgroundColor: '#1a6d2f', // Match pitch color
                        scale: 2,
                        logging: false,
                        ignoreElements: (element) => {
                            return element.classList.contains('no-print');
                        }
                    });

                    canvas.toBlob(async (blob) => {
                        const file = new File([blob], "maccabi-tlv-lineup.png", { type: "image/png" });

                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    files: [file],
                                    title: 'Maccabi TLV Lineup',
                                    text: 'My Starting 11 ðŸ’›ðŸ’™'
                                });
                            } catch (error) {
                                console.log('Share failed', error);
                            }
                        } else {
                            const link = document.createElement('a');
                            link.download = 'maccabi-tlv-lineup.png';
                            link.href = canvas.toDataURL();
                            link.click();
                        }
                        setIsCapturing(false);
                    });
                } catch (err) {
                    console.error("Screenshot failed", err);
                    alert("Could not create image. Please try again.");
                    setIsCapturing(false);
                }
            };

            const handleFieldTouchDrop = (clientX, clientY) => {
                if (!touchDragItem.current || touchDragItem.current.source !== 'field') return;

                const rect = fieldRef.current.getBoundingClientRect();
                const x = Math.max(5, Math.min(95, ((clientX - rect.left) / rect.width) * 100));
                const y = Math.max(5, Math.min(95, ((clientY - rect.top) / rect.height) * 100));

                // Capture index locally to avoid race condition with null ref inside setState
                const draggedIndex = touchDragItem.current.index;

                setPlayers(prev => {
                    const newP = [...prev];
                    if (newP[draggedIndex]) {
                        newP[draggedIndex] = { ...newP[draggedIndex], top: y, left: x };
                    }
                    return newP;
                });
            };

            const onFieldDrop = (e) => {
                e.preventDefault();
                if (!dragInfo || dragInfo.source !== 'field') return;

                const rect = fieldRef.current.getBoundingClientRect();
                const x = Math.max(5, Math.min(95, ((e.clientX - rect.left) / rect.width) * 100));
                const y = Math.max(5, Math.min(95, ((e.clientY - rect.top) / rect.height) * 100));

                setPlayers(prev => {
                    const newP = [...prev];
                    newP[dragInfo.index] = { ...newP[dragInfo.index], top: y, left: x };
                    return newP;
                });
                setDragInfo(null);
            };

            return (
                <div className="flex flex-col h-[100dvh] w-full max-w-3xl mx-auto bg-slate-900 shadow-2xl relative overflow-hidden">
                    {/* Field Area */}
                    {/* Field Area - Takes all available space minus bench */}
                    <div ref={fieldRef}
                        onDragOver={onDragOver}
                        onDrop={onFieldDrop}
                        className="relative flex-1 m-1 border-2 border-white overflow-hidden shadow-inner flex flex-col pitch-pattern">

                        {/* Floating Controls - Glassmorphism */}
                        <div className="absolute top-2 right-2 z-[60] flex flex-col gap-2 items-end no-print">
                            <select className="bg-black/40 text-white text-[12px] px-4 py-2 rounded-full font-bold outline-none border border-white/10 backdrop-blur-md shadow-lg uppercase tracking-wider"
                                value={formation} onChange={(e) => {
                                    const f = e.target.value;
                                    setFormation(f);
                                    if (f !== "Custom") {
                                        setPlayers(prev => prev.map((p, i) => ({ ...p, top: FORMATIONS[f][i].t, left: FORMATIONS[f][i].l })));
                                    }
                                }}>
                                {Object.keys(FORMATIONS).map(f => <option key={f} value={f}>{f}</option>)}
                            </select>

                            <div className="flex gap-2 items-center">
                                <button onClick={captureField} disabled={isCapturing}
                                    className="bg-black/20 text-white text-lg w-8 h-8 rounded-full font-bold outline-none border border-white/10 backdrop-blur-md shadow-lg hover:bg-white/10 transition-all flex items-center justify-center active:scale-95 leading-none">
                                    {isCapturing ? 'âŒ›' : (
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-4 h-4">
                                            <path fillRule="evenodd" d="M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z" clipRule="evenodd" />
                                        </svg>
                                    )}
                                </button>

                                <button onClick={() => {
                                    const confirmed = confirm('Reset squad to default 2026 roster?');
                                    if (confirmed) {
                                        setPlayers(FULL_SQUAD.slice(0, 11).map((p, i) => ({
                                            ...p, top: formation !== "Custom" ? FORMATIONS[formation][i].t : p.top,
                                            left: formation !== "Custom" ? FORMATIONS[formation][i].l : p.left
                                        })));
                                        setBench(FULL_SQUAD.slice(11));
                                    }
                                }}
                                    className="bg-black/20 text-white text-lg w-8 h-8 rounded-full font-bold outline-none border border-white/10 backdrop-blur-md shadow-lg hover:bg-white/10 transition-all flex items-center justify-center active:scale-95 leading-none">
                                    â†º
                                </button>
                            </div>
                        </div>

                        {/* App Title Overlay (since header is gone) */}
                        <div className="absolute top-2 left-2 z-[50] pointer-events-none opacity-40">
                            <span className="text-[8px] font-bold text-white uppercase tracking-widest leading-none block">Maccabi TLV</span>
                            <h1 className="text-sm font-black italic tracking-tighter uppercase text-yellow-500">EEM ANII</h1>
                        </div>

                        {/* Field Markings */}
                        <div className="field-line center-line"></div>
                        <div className="center-circle"></div>
                        <div className="center-spot"></div>
                        <div className="penalty-box penalty-box-top"></div>
                        <div className="penalty-box penalty-box-bottom"></div>
                        <div className="goal-box goal-box-top"></div>
                        <div className="goal-box goal-box-bottom"></div>
                        <div className="goalkeeper-arc goalkeeper-arc-top"></div>
                        <div className="goalkeeper-arc goalkeeper-arc-bottom"></div>
                        <div className="penalty-spot penalty-spot-top"></div>
                        <div className="penalty-spot penalty-spot-bottom"></div>
                        <div className="corner-arc corner-top-left"></div>
                        <div className="corner-arc corner-top-right"></div>
                        <div className="corner-arc corner-bottom-left"></div>
                        <div className="corner-arc corner-bottom-right"></div>
                        <div className="goal goal-top"></div>
                        <div className="goal goal-bottom"></div>

                        {players.map((p, i) => (
                            <div key={p.id}
                                draggable
                                onDragStart={(e) => onDragStart(e, i, 'field')}
                                onDragOver={onDragOver}
                                onDrop={(e) => onDrop(e, i, 'field')}
                                onTouchStart={(e) => onTouchStart(e, i, 'field')}
                                onTouchMove={onTouchMove}
                                onTouchEnd={onTouchEnd}
                                data-droptarget="true"
                                data-index={i}
                                data-source="field"
                                onClick={(e) => { e.stopPropagation(); setSelectedPlayer(p); }}
                                onDoubleClick={(e) => { e.stopPropagation(); setCaptainId(p.id); }}
                                className={`absolute -translate-x-1/2 -translate-y-1/2 flex flex-col items-center player-node cursor-grab active:cursor-grabbing transition-all duration-200 
                                    ${isDragging?.playerIndex === i && isDragging?.source === 'field' ? 'dragging opacity-50 scale-110 z-50' : ''}
                                    ${isDragging && (isDragging.playerIndex !== i || isDragging.source !== 'field') ? 'drop-target-active' : ''}
                                `}
                                style={{ top: `${p.top}%`, left: `${p.left}%` }}>

                                <div className={`relative w-12 h-12 rounded-full border-2 shadow-2xl flex items-center justify-center font-black text-sm
                                    ${p.native === 'GK' ? 'bg-orange-600 border-white text-white' : 'bg-yellow-400 border-blue-900 text-blue-900'}`}>
                                    {p.number}
                                    {captainId === p.id && (
                                        <span className="absolute -top-1 -right-1 bg-white text-blue-900 w-5 h-5 rounded-full border border-blue-900 flex items-center justify-center text-[8px] font-black">C</span>
                                    )}
                                    {/* Status Icons */}
                                    {p.status === 'injured' && (
                                        <span className="absolute -bottom-1 -right-1 bg-white w-5 h-5 rounded-full border border-red-500 flex items-center justify-center text-[10px] font-bold text-red-600" title="Injured">
                                            âœš
                                        </span>
                                    )}
                                    {p.status === 'red-card' && (
                                        <span className="absolute -bottom-1 -right-1 bg-red-600 w-4 h-5 rounded-sm border border-white shadow-sm flex items-center justify-center text-[8px] text-white font-bold" title="Red Card"></span>
                                    )}
                                    {p.status === 'suspended-yellow' && (
                                        <div className="absolute -bottom-1 -right-1 flex" title="Suspended (Yellow Accumulation)">
                                            <span className="bg-red-600 w-4 h-5 rounded-sm border border-white shadow-sm flex items-center justify-center text-[8px] text-white font-bold"></span>
                                        </div>
                                    )}
                                    {p.status === 'yellow-card' && (
                                        <span className="absolute -bottom-1 -right-1 bg-yellow-400 w-4 h-5 rounded-sm border border-white shadow-sm flex items-center justify-center text-[8px] text-white font-bold" title="Yellow Card"></span>
                                    )}
                                    {p.status === 'yellow-risk' && (
                                        <span className="absolute -bottom-1 -right-1 bg-yellow-400 w-4 h-5 rounded-sm border-2 border-orange-500 shadow-sm flex items-center justify-center text-[8px] text-white font-bold" title="Suspension Risk (4 Yellows)">!</span>
                                    )}
                                </div>
                                <div className="bg-blue-950/90 text-[10px] px-2 py-0.5 rounded-full mt-1.5 font-bold border border-white/20 uppercase tracking-tighter text-center flex flex-col">
                                    <span>{p.name}</span>
                                    <span className="text-[7px] text-yellow-500 opacity-80">{p.native}</span>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Bench Area - Optimized for Mobile Visibility */}
                    {/* Bench Area - Auto height based on content, safe bottom padding */}
                    <div className="bg-slate-900/80 backdrop-blur-md px-2 pt-2 pb-12 border-t border-white/10 shrink-0 flex flex-col relative shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.5)] z-40">
                        <div className="flex gap-3 overflow-x-auto pb-2 bench-scroll items-center">
                            {bench.map((p, i) => (
                                <div key={p.id}
                                    draggable
                                    onDragStart={(e) => onDragStart(e, i, 'bench')}
                                    onDragOver={onDragOver}
                                    onDrop={(e) => onDrop(e, i, 'bench')}
                                    onTouchStart={(e) => onTouchStart(e, i, 'bench')}
                                    onTouchMove={onTouchMove}
                                    onTouchEnd={onTouchEnd}
                                    data-droptarget="true"
                                    data-index={i}
                                    data-source="bench"
                                    style={{ touchAction: 'none' }}
                                    onClick={() => setSelectedPlayer(p)}
                                    className={`flex-shrink-0 flex flex-col items-center cursor-grab active:scale-95 transition-transform group w-20
                                        ${isDragging?.playerIndex === i && isDragging?.source === 'bench' ? 'opacity-50' : ''}
                                        ${isDragging && (isDragging.playerIndex !== i || isDragging.source !== 'bench') ? 'drop-target-active rounded-xl bg-slate-800/50' : ''}
                                    `}>
                                    <div className="relative w-14 h-14 bg-slate-800 rounded-full border-2 border-slate-600 flex items-center justify-center text-lg font-black shadow-lg group-hover:border-yellow-500 transition-colors">
                                        {p.number}
                                        {captainId === p.id && <span className="absolute -top-1 -right-1 bg-yellow-500 text-blue-900 w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-black border-2 border-slate-800">C</span>}
                                    </div>
                                    <p className="text-[11px] mt-2 text-slate-300 font-bold tracking-tight text-center leading-tight">{p.name}</p>
                                    <p className="text-[9px] text-slate-500 uppercase tracking-widest">{p.native}</p>
                                </div>
                            ))}
                        </div>
                        <div className="absolute bottom-2 left-1/2 -translate-x-1/2 z-0 pointer-events-none opacity-30">
                            <span className="text-[9px] font-bold text-slate-400 uppercase tracking-[0.4em]">Substitutes</span>
                        </div>
                    </div>

                    {/* Player Tooltip / Bottom Sheet */}
                    {selectedPlayer && (
                        <>
                            <div className="fixed inset-0 z-[90] bg-black/60 backdrop-blur-sm transition-opacity" onClick={() => setSelectedPlayer(null)}></div>
                            <div className="fixed bottom-0 left-0 right-0 z-[100] bg-white text-slate-900 rounded-t-3xl p-6 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.5)] animate-slide-up md:absolute md:top-1/2 md:left-1/2 md:bottom-auto md:w-80 md:rounded-2xl md:-translate-x-1/2 md:-translate-y-1/2 md:shadow-2xl">
                                <div className="absolute top-2 left-1/2 -translate-x-1/2 w-12 h-1.5 bg-slate-200 rounded-full md:hidden"></div>
                                <div className="flex justify-between items-start mb-6 mt-2 md:mt-0">
                                    <div>
                                        <h3 className="text-4xl font-black text-blue-900 uppercase leading-none italic tracking-tighter">{selectedPlayer.name}</h3>
                                        <div className="flex items-center gap-2 mt-1">
                                            <span className="bg-blue-900 text-white text-xs font-bold px-2 py-0.5 rounded md:text-sm">{selectedPlayer.native}</span>
                                            <span className="text-xl font-bold text-slate-300">#{selectedPlayer.number}</span>
                                        </div>
                                    </div>
                                    <button onClick={(e) => { e.stopPropagation(); setCaptainId(selectedPlayer.id); }}
                                        className={`text-sm font-black px-4 py-2 rounded-full border-2 transition-all uppercase tracking-wider ${captainId === selectedPlayer.id ? 'bg-yellow-500 border-yellow-500 text-blue-900 shadow-lg' : 'border-blue-900 text-blue-900 hover:bg-blue-50'}`}>
                                        {captainId === selectedPlayer.id ? 'â˜… Captain' : 'Make Captain'}
                                    </button>
                                </div>

                                <div className={`grid ${selectedPlayer.native === 'GK' ? 'grid-cols-2' : 'grid-cols-3'} gap-3 mb-6`}>
                                    <div className="bg-slate-50 p-3 rounded-2xl border-b-4 border-yellow-500 text-center shadow-sm">
                                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Matches</p>
                                        <p className="text-3xl font-black text-blue-900 mt-1">{selectedPlayer.mp || '-'}</p>
                                    </div>
                                    {selectedPlayer.native === 'GK' ? (
                                        <div className="bg-slate-50 p-3 rounded-2xl border-b-4 border-blue-900 text-center shadow-sm">
                                            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Clean Sheets</p>
                                            <p className="text-3xl font-black text-blue-900 mt-1">{selectedPlayer.cs || '-'}</p>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="bg-slate-50 p-3 rounded-2xl border-b-4 border-green-500 text-center shadow-sm">
                                                <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Goals</p>
                                                <p className="text-3xl font-black text-blue-900 mt-1">{selectedPlayer.g || 0}</p>
                                            </div>
                                            <div className="bg-slate-50 p-3 rounded-2xl border-b-4 border-blue-900 text-center shadow-sm">
                                                <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Assists</p>
                                                <p className="text-3xl font-black text-blue-900 mt-1">{selectedPlayer.a || 0}</p>
                                            </div>
                                        </>
                                    )}
                                </div>

                                <div className="space-y-3">
                                    <div className={`p-4 rounded-xl border-l-4 shadow-sm flex items-center justify-between ${selectedPlayer.status === 'injured' ? 'bg-red-50 border-red-500' :
                                        selectedPlayer.status === 'yellow-card' || selectedPlayer.status === 'yellow-risk' ? 'bg-orange-50 border-orange-500' :
                                            selectedPlayer.status === 'red-card' || selectedPlayer.status === 'suspended-yellow' ? 'bg-red-50 border-red-600' : // Suspended styling
                                                'bg-green-50 border-green-500'
                                        }`}>
                                        <div className="flex items-center gap-3">
                                            {(selectedPlayer.status === 'yellow-card' || selectedPlayer.status === 'yellow-risk') && (
                                                <div className="w-4 h-5 bg-yellow-400 border border-white/50 rounded-sm shadow-sm"></div>
                                            )}
                                            {(selectedPlayer.status === 'red-card' || selectedPlayer.status === 'suspended-yellow') && (
                                                <div className="w-4 h-5 bg-red-600 border border-white/50 rounded-sm shadow-sm"></div>
                                            )}
                                            {selectedPlayer.status === 'injured' && (
                                                <span className="text-lg">ðŸš‘</span>
                                            )}
                                            <span className={`text-lg font-black uppercase tracking-tight ${selectedPlayer.status === 'injured' || selectedPlayer.status === 'red-card' || selectedPlayer.status === 'suspended-yellow' ? 'text-red-900' :
                                                selectedPlayer.status === 'yellow-card' || selectedPlayer.status === 'yellow-risk' ? 'text-orange-900' :
                                                    'text-green-900'
                                                }`}>
                                                {selectedPlayer.status === 'injured' ? 'Injured' :
                                                    selectedPlayer.status === 'red-card' ? 'Suspended (Red)' :
                                                        selectedPlayer.status === 'suspended-yellow' ? 'Suspended (Yellows)' :
                                                            selectedPlayer.status === 'yellow-risk' ? 'Suspension Risk' :
                                                                selectedPlayer.status === 'yellow-card' ? 'Yellow Card' :
                                                                    'Available'}
                                            </span>
                                        </div>
                                        <p className="text-[10px] font-bold opacity-60 uppercase tracking-widest">Condition</p>
                                    </div>
                                    <div className="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500 shadow-sm flex justify-between items-center">
                                        <span className="text-sm font-bold text-blue-900 uppercase">{selectedPlayer.strength || 'Key Player'}</span>
                                        <p className="text-[10px] font-bold text-blue-500 uppercase tracking-widest">Strength</p>
                                    </div>
                                </div>
                            </div>
                        </>
                    )}
                    {/* Floating App Icon / Splash Toggle */}
                    {!showSplash && <FloatingIcon setShowSplash={setShowSplash} />}

                    {/* Splash Screen */}
                    {showSplash && (
                        <div onClick={() => setShowSplash(false)} className="fixed inset-0 z-[2000] bg-slate-900/95 backdrop-blur-sm flex flex-col items-center justify-center cursor-pointer animate-fade-in p-6">
                            <div className="text-center animate-bounce-slow max-w-sm w-full">
                                <img src="./eem-ani.jpg" alt="EEM ANII" className="w-full rounded-2xl shadow-2xl border-4 border-yellow-500 mb-6 rotate-3 hover:rotate-0 transition-transform duration-500" />
                                <h1 className="text-4xl font-black italic text-yellow-500 tracking-tighter drop-shadow-2xl mb-2">EEM ANII</h1>
                                <p className="text-blue-200 text-lg font-bold tracking-widest uppercase">Maccabi Tel Aviv 2026</p>
                                <p className="mt-8 text-sm text-slate-400 animate-pulse">Tap anywhere to start</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
